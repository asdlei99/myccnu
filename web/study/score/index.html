<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8"/>
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
	<link rel="stylesheet" type="text/css" href="../../lib/css/main.css">
	<link rel="stylesheet" type="text/css" href="../../lib/css/semantic.min.css">
	<script src="../../lib/js/jquery.min.js"></script>
	<script src="../../lib/js/semantic.min.js"></script>
	<script src="../../lib/js/handlebars-v1.3.0.js"></script>
	<script src="../../lib/js/main.js"></script>
	<title>期末成绩</title>
</head>
<body>

<!--显示所有成绩的容器-->
<div class="ui stackable three column page grid" id="Score_Con">

</div>

<!--提示-->
<div class="ui page grid one column">
	<div class="ui column">
		<div class="ui message floating info">
			单击你的一门成绩单可以看到全校的成绩统计
		</div>
	</div>
</div>

<!--page正在加载中-->
<div class="ui page dimmer" id="Page_Dimmer">
	<div class="content">
		<div class="center">
			<h2 class="ui inverted icon header">
				<i class="icon loading green"></i>
				正在玩命计算中....
			</h2>
		</div>
	</div>
</div>

<script>
	var GetMyScore_URL = makeApiUrl("score/get");
	var Score_Con = $('#Score_Con');
	var TempHTML = '';
	$(document).ready(function () {//进入页面时加载本人的信息
		if (getCookie('XH').length > 0) {
			$('#Page_Dimmer').dimmer('show');
			$.getJSON(GetMyScore_URL).done(function (data) {
				TempHTML = toHTML('Score_TEMP', data);//保存原来的
				Score_Con.append(TempHTML);
				$('#Page_Dimmer').dimmer('hide');
				if (data.length < 1) {
					showError();
				}
			});
		} else {//还没有绑定
			shouldBind();
		}
	});

	var GetScore_ClassID_URL = makeApiUrl('score/get_ClassId');
	/**
	 *  查看一门课程的统计情况
	 */
	function getScore_ClassID(classID, xh) {
		$.getJSON(GetScore_ClassID_URL, {classId: classID}).done(function (data) {
			//求平均值,挂科数
			var basic = {
				pinshiScore: 0,
				qimoScore: 0,
				sumScore: 0,
				guakeCount: 0,
				rank: 0
			};
			$(data).each(function () {
				basic.pinshiScore += this.pinshiScore;
				basic.qimoScore += this.qimoScore;
				basic.sumScore += this.sumScore;
				if (this.xh == xh) {
					basic.rank = $.index;
				}
				if (this.sumScore < 60) {
					basic.guakeCount++;
				}
			});
			basic.pinshiScore /= data.length;
			basic.qimoScore /= data.length;
			basic.sumScore /= data.length;
			Score_Con.html('');//清空原来的
			Score_Con.append(toHTML('Basic_TEMP', basic));
			Score_Con.append(toHTML('Score_TEMP', data));
			goTop();
		});
	}

	/**
	 * 退回到自己的成绩列表
	 */
	function goBack() {
		Score_Con.html(TempHTML);
		goTop();
	}

</script>

<!--模版-->
<div class="hidden">

	<script>
		//60分以上绿色,以下红色
		Handlebars.registerHelper('color', function (object) {
			if (object >= 60) {
				return 'green';
			} else {
				return 'red';
			}
		});
	</script>

	<!--一条成绩-->
	<div id="Score_TEMP">
		{{#.}}
		<div class="column">
			<div class="ui stacked segment {{color sumScore}}" onclick="getScore_ClassID({{classNo}},{{xh}})">

				<div class="ui statistic">
					<div class="number">{{sumScore}}
					</div>
				</div>

				<div class="ui relaxed divided list">

					<div class="item">
						<i class="book icon circular inverted"></i>

						<div class="content">
							<a class="header">{{className}}</a>

							<div class="description">名称
							</div>
						</div>
					</div>

					<div class="item">
						<i class="screenshot icon circular inverted"></i>

						<div class="content">
							<a class="header">{{qimoScore}}</a>

							<div class="description">期末
							</div>
						</div>
					</div>
					<div class="item">
						<i class="tint icon circular inverted"></i>

						<div class="content">
							<a class="header">{{pinshiScore}}</a>

							<div class="description">平时
							</div>
						</div>
					</div>
					<div class="item">
						<i class="star icon circular inverted"></i>

						<div class="content">
							<a class="header">{{xuefen}}</a>

							<div class="description">学分
							</div>
						</div>
					</div>
				</div>

			</div>
		</div>

		{{/.}}
	</div>

	<!--一个基本统计信息-->
	<div id="Basic_TEMP">
		{{#.}}
		<div class="column">
			<div class="ui stacked segment green inverted">

				<div class="ui statistic">
					<div class="number">统计报表
					</div>
					<div class="ui button circular" onclick="goBack()">返回</div>
				</div>

				<div class="ui relaxed divided list">

					<div class="item">
						<i class="building icon circular inverted"></i>

						<div class="content">
							<a class="header">{{rank}}</a>

							<div class="description">你的排名
							</div>
						</div>
					</div>

					<div class="item">
						<i class="building icon circular inverted"></i>

						<div class="content">
							<a class="header">{{sumScore}}</a>

							<div class="description">总评平均
							</div>
						</div>
					</div>

					<div class="item">
						<i class="screenshot icon circular inverted"></i>

						<div class="content">
							<a class="header">{{qimoScore}}</a>

							<div class="description">期末平均
							</div>
						</div>
					</div>
					<div class="item">
						<i class="tint icon circular inverted"></i>

						<div class="content">
							<a class="header">{{pinshiScore}}</a>

							<div class="description">平时平均
							</div>
						</div>
					</div>
					<div class="item">
						<i class="frown icon circular inverted"></i>

						<div class="content">
							<a class="header">{{guakeCount}}</a>

							<div class="description">有多少同学跪
							</div>
						</div>
					</div>
				</div>

			</div>
		</div>
		{{/.}}
	</div>

</div>


</body>
</html>